<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OBS Remote Control</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="app-container">
    <!-- Header / Connection Bar -->
    <header class="header">
      <div class="header-left">
        <h1><i class="fas fa-broadcast-tower"></i> OBS Remote Control</h1>
      </div>
      <div class="header-right">
        <div class="connection-panel">
          <button id="open-settings-btn" class="btn-icon" title="Settings">
            <i class="fas fa-sliders-h"></i>
          </button>
          <div class="connection-selector">
            <select id="saved-connections" class="connection-dropdown">
              <option value="">-- New Connection --</option>
            </select>
            <button id="save-connection-btn" class="btn-icon" title="Save Connection">
              <i class="fas fa-save"></i>
            </button>
            <button id="delete-connection-btn" class="btn-icon" title="Delete Connection">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <input type="text" id="ws-host" placeholder="Host (e.g., localhost)" value="localhost">
          <input type="text" id="ws-port" placeholder="Port (e.g., 4455)" value="4455">
          <input type="password" id="ws-password" placeholder="Password (optional)">
          <button id="connect-btn" class="btn btn-primary">
            <i class="fas fa-plug"></i> Connect
          </button>
          <div class="status-indicator" id="status-indicator">
            <span class="status-dot disconnected"></span>
            <span class="status-text">Disconnected</span>
          </div>
        </div>
        <div class="layout-presets">
          <div class="layout-group">
            <label for="layout-preset-select" class="sr-only">Layout Preset</label>
            <select id="layout-preset-select" class="layout-dropdown"></select>
            <button id="save-layout-preset" class="btn-icon" title="Save Layout Preset">
              <i class="fas fa-save"></i>
            </button>
            <button id="delete-layout-preset" class="btn-icon" title="Delete Layout Preset">
              <i class="fas fa-trash"></i>
            </button>
            <button id="reset-layout-preset" class="btn-icon" title="Reset Layout Presets">
              <i class="fas fa-undo"></i>
            </button>
          </div>
          <div class="layout-group">
            <label for="layout-density-select" class="sr-only">Density</label>
            <select id="layout-density-select" class="layout-dropdown density-dropdown">
              <option value="expanded">Expanded</option>
              <option value="compact">Compact</option>
            </select>
            <label for="sidebar-left-width" class="sr-only">Left Sidebar Width</label>
            <input type="number" id="sidebar-left-width" class="layout-size-input" min="200" max="420" step="10" value="280" title="Left Sidebar Width (px)">
            <label for="sidebar-right-width" class="sr-only">Right Sidebar Width</label>
            <input type="number" id="sidebar-right-width" class="layout-size-input" min="200" max="420" step="10" value="300" title="Right Sidebar Width (px)">
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Left Sidebar - Scenes and Sources -->
      <aside class="sidebar sidebar-left">
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-layer-group"></i> Scenes</h2>
            <button class="btn-icon" id="refresh-scenes" title="Refresh scenes"><i class="fas fa-sync"></i></button>
          </div>
          <div class="panel-body">
            <div class="thumb-controls">
              <label class="toggle-switch compact">
                <input type="checkbox" id="thumbnail-toggle">
                <span class="toggle-slider"></span>
                <span class="toggle-label">Thumbnails</span>
              </label>
              <label class="thumb-interval-label" for="thumbnail-interval">Refresh (s):</label>
              <input type="number" id="thumbnail-interval" min="5" max="120" value="10">
            </div>
            <div id="scenes-list" class="list-container">
              <div class="empty-state">Not connected to OBS</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-cube"></i> Sources</h2>
          </div>
          <div class="panel-body">
            <div id="sources-list" class="list-container">
              <div class="empty-state">Select a scene</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-exchange-alt"></i> Transitions</h2>
          </div>
          <div class="panel-body">
            <div class="transition-controls">
              <select id="transition-select" class="select-input">
                <option value="">Loading...</option>
              </select>
              <div class="duration-control">
                <label>Duration (ms):</label>
                <input type="number" id="transition-duration" value="300" min="50" max="20000" step="50">
              </div>
              <button id="transition-btn" class="btn btn-warning" disabled style="margin-top: 10px; width: 100%;">
                <i class="fas fa-arrow-right"></i> Transition (Studio Mode)
              </button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Center - Preview/Program -->
      <section class="center-content">
        <div class="studio-mode-toggle">
          <label class="toggle-switch">
            <input type="checkbox" id="studio-mode-toggle">
            <span class="toggle-slider"></span>
            <span class="toggle-label">Studio Mode</span>
          </label>
        </div>

        <!-- Studio Mode Scene Indicators -->
        <div id="studio-mode-indicators" class="studio-mode-indicators" style="display: none;">
          <div class="scene-indicator program-indicator">
            <div class="indicator-label">PROGRAM (Live)</div>
            <div class="indicator-scene" id="program-scene-name">No Scene</div>
          </div>
          <div class="transition-arrow">
            <i class="fas fa-arrow-right"></i>
          </div>
          <div class="scene-indicator preview-indicator">
            <div class="indicator-label">PREVIEW (Next)</div>
            <div class="indicator-scene" id="preview-scene-name">No Scene</div>
          </div>
        </div>

        <!-- 
          Preview panels removed from view - video streaming not supported by OBS WebSocket
          Code preserved below for potential future use if WebSocket protocol adds video support
        -->
        <!-- 
        <div id="single-preview" class="preview-container single-mode" style="display: none;">
          <div class="preview-panel">
            <div class="preview-header">
              <h3>Program Output</h3>
            </div>
            <div class="preview-display" id="program-preview">
              <canvas id="program-canvas" style="display: none;"></canvas>
              <div class="preview-placeholder">
                <i class="fas fa-video"></i>
                <p>Video Preview Not Available</p>
                <small>OBS WebSocket doesn't stream video frames.<br>Use OBS Studio window for video preview.</small>
              </div>
            </div>
          </div>
        </div>

        <div id="studio-preview" class="preview-container studio-mode" style="display: none;">
          <div class="preview-panel">
            <div class="preview-header">
              <h3>Preview (Studio Mode)</h3>
            </div>
            <div class="preview-display" id="studio-preview-display">
              <canvas id="preview-canvas" style="display: none;"></canvas>
              <div class="preview-placeholder">
                <i class="fas fa-eye"></i>
                <p>Preview</p>
                <small>Video preview not available via WebSocket</small>
              </div>
            </div>
          </div>
          <div class="preview-panel">
            <div class="preview-header">
              <h3>Program (Live)</h3>
            </div>
            <div class="preview-display" id="studio-program-display">
              <canvas id="live-canvas" style="display: none;"></canvas>
              <div class="preview-placeholder">
                <i class="fas fa-broadcast-tower"></i>
                <p>Live Output</p>
                <small>Video preview not available via WebSocket</small>
              </div>
            </div>
          </div>
          <div class="transition-button-container">
            <button id="transition-btn" class="btn btn-large btn-warning" disabled>
              <i class="fas fa-arrow-right"></i> Transition
            </button>
          </div>
        </div>
        -->

        <!-- Stream/Recording Controls -->
        <div class="controls-panel">
          <div class="control-group">
            <button id="stream-btn" class="btn btn-success" disabled>
              <i class="fas fa-circle"></i> Start Streaming
            </button>
            <button id="record-btn" class="btn btn-danger" disabled>
              <i class="fas fa-record-vinyl"></i> Start Recording
            </button>
            <button id="pause-record-btn" class="btn btn-secondary" disabled>
              <i class="fas fa-pause"></i> Pause Recording
            </button>
            <button id="virtualcam-btn" class="btn btn-secondary" disabled>
              <i class="fas fa-video"></i> Start Virtual Camera
            </button>
          </div>
        </div>

        <!-- Stats Display -->
        <div class="stats-panel">
          <div class="stat-item">
            <i class="fas fa-clock"></i>
            <span class="stat-label">Streaming Time:</span>
            <span id="stream-time" class="stat-value">--:--:--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-video"></i>
            <span class="stat-label">Recording Time:</span>
            <span id="record-time" class="stat-value">--:--:--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-tachometer-alt"></i>
            <span class="stat-label">FPS:</span>
            <span id="fps-value" class="stat-value">--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-microchip"></i>
            <span class="stat-label">CPU:</span>
            <span id="cpu-value" class="stat-value">--%</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-memory"></i>
            <span class="stat-label">Memory:</span>
            <span id="memory-value" class="stat-value">-- MB</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-wifi"></i>
            <span class="stat-label">Bitrate:</span>
            <span id="bitrate-value" class="stat-value">-- kbps</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-upload"></i>
            <span class="stat-label">Bytes Sent:</span>
            <span id="bytes-sent" class="stat-value">--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-download"></i>
            <span class="stat-label">Bytes Received:</span>
            <span id="bytes-received" class="stat-value">--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-heartbeat"></i>
            <span class="stat-label">Network Health:</span>
            <span id="network-health" class="stat-value health-neutral">--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-wave-square"></i>
            <span class="stat-label">Drop Trend:</span>
            <span id="drop-trend" class="stat-value">--</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-chart-line"></i>
            <span class="stat-label">Dropped Frames:</span>
            <span id="dropped-frames" class="stat-value">0 (0%)</span>
          </div>
        </div>
        <div class="stats-settings">
          <div class="settings-item">
            <label for="stats-interval-input">Stats Interval (ms)</label>
            <input type="number" id="stats-interval-input" min="250" step="250" value="1000">
          </div>
          <div class="settings-item">
            <label for="clip-threshold-input">Clip Alert (dB)</label>
            <input type="number" id="clip-threshold-input" min="-30" max="0" step="1" value="-5">
          </div>
          <div class="settings-item">
            <label for="drop-alert-input">Drop Alert (%)</label>
            <input type="number" id="drop-alert-input" min="0" max="50" step="0.5" value="5">
          </div>
        </div>
      </section>

      <!-- Right Sidebar - Audio Mixer & Collections -->
      <aside class="sidebar sidebar-right">
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-volume-up"></i> Global Audio</h2>
          </div>
          <div class="panel-body">
            <div id="global-audio-mixer" class="audio-mixer">
              <div class="empty-state">No global audio sources</div>
            </div>
          </div>
        </div>
        
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-music"></i> Scene Audio</h2>
          </div>
          <div class="panel-body">
            <div id="scene-audio-mixer" class="audio-mixer">
              <div class="empty-state">No scene audio sources</div>
            </div>
          </div>
        </div>
        
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-layer-group"></i> Scene Collections</h2>
            <button class="btn-icon" id="refresh-collections" title="Refresh">
              <i class="fas fa-sync"></i>
            </button>
          </div>
          <div class="panel-body">
            <div id="collections-list" class="list-container">
              <div class="empty-state">Not connected to OBS</div>
            </div>
          </div>
        </div>
        
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-sitemap"></i> Profiles</h2>
            <button class="btn-icon" id="refresh-profiles" title="Refresh">
              <i class="fas fa-sync"></i>
            </button>
          </div>
          <div class="panel-body">
            <div id="profiles-list" class="list-container">
              <div class="empty-state">Not connected to OBS</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-folder-open"></i> Recordings</h2>
            <button class="btn-icon" id="refresh-recordings" title="Refresh">
              <i class="fas fa-sync"></i>
            </button>
          </div>
          <div class="panel-body">
            <div id="recordings-list" class="list-container recordings-list">
              <div class="empty-state">Recordings list requires OBS connection</div>
            </div>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Custom Dialog for Connection Name (prompt() replacement) -->
  <div id="connection-name-dialog" class="modal-overlay" style="display: none;">
    <div class="modal-dialog">
      <div class="modal-header">
        <h3>Save Connection</h3>
      </div>
      <div class="modal-body">
        <label for="connection-name-input">Connection Name:</label>
        <input type="text" id="connection-name-input" class="modal-input" placeholder="e.g., Studio PC">
      </div>
      <div class="modal-footer">
        <button id="dialog-cancel-btn" class="btn btn-secondary">Cancel</button>
        <button id="dialog-save-btn" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Settings / Preferences Panel -->
  <div id="settings-modal" class="modal-overlay" style="display: none;">
    <div class="modal-dialog wide">
      <div class="modal-header">
        <h3><i class="fas fa-sliders-h"></i> Settings</h3>
        <button id="settings-close-btn" class="btn-icon"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="settings-grid">
          <div class="settings-card">
            <h4>Polling & Ranges</h4>
            <label>Stats Interval (ms)</label>
            <input type="number" id="settings-stats-interval" min="500" step="100">
            <label>Sync Interval (ms)</label>
            <input type="number" id="settings-sync-interval" min="500" step="100">
            <label>Meter Range (dB)</label>
            <div class="inline-inputs">
              <input type="number" id="settings-min-db" step="1">
              <span class="inline-separator">to</span>
              <input type="number" id="settings-max-db" step="1">
            </div>
          </div>
          <div class="settings-card">
            <h4>Theme</h4>
            <label>Accent Color</label>
            <input type="color" id="settings-accent">
            <label>Background Tone</label>
            <select id="settings-theme-mode">
              <option value="dark">Dark</option>
              <option value="dim">Dim</option>
            </select>
          </div>
          <div class="settings-card">
            <h4>Auto-Reconnect</h4>
            <label class="checkbox-row">
              <input type="checkbox" id="settings-auto-reconnect">
              <span>Enable auto-reconnect</span>
            </label>
            <label>Delay (ms)</label>
            <input type="number" id="settings-reconnect-delay" min="500" step="100">
            <label>Jitter (ms)</label>
            <input type="number" id="settings-reconnect-jitter" min="0" step="50">
            <label>Max Attempts</label>
            <input type="number" id="settings-reconnect-attempts" min="1" step="1">
          </div>
          <div class="settings-card">
            <h4>Default Connection</h4>
            <label>Use on launch</label>
            <select id="settings-default-connection">
              <option value="">None</option>
            </select>
          </div>
          <div class="settings-card shortcuts-card">
            <h4>Shortcuts</h4>
            <div class="shortcut-row">
              <span>Connect / Disconnect</span>
              <input type="text" data-action="toggleConnect" class="shortcut-input">
            </div>
            <div class="shortcut-row">
              <span>Start / Stop Stream</span>
              <input type="text" data-action="toggleStream" class="shortcut-input">
            </div>
            <div class="shortcut-row">
              <span>Start / Stop Record</span>
              <input type="text" data-action="toggleRecord" class="shortcut-input">
            </div>
            <div class="shortcut-row">
              <span>Toggle Studio Mode</span>
              <input type="text" data-action="toggleStudioMode" class="shortcut-input">
            </div>
            <div class="shortcut-row">
              <span>Trigger Transition</span>
              <input type="text" data-action="triggerTransition" class="shortcut-input">
            </div>
            <label>Import / Export JSON</label>
            <textarea id="shortcut-json" class="modal-input" rows="3" placeholder='{"toggleStream": "Ctrl+Shift+S"}'></textarea>
            <div class="shortcut-actions">
              <button id="shortcut-reset-btn" class="btn btn-secondary">Reset Defaults</button>
              <button id="shortcut-export-btn" class="btn btn-secondary">Export</button>
              <button id="shortcut-import-btn" class="btn btn-primary">Import</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="settings-cancel-btn" class="btn btn-secondary">Cancel</button>
        <button id="settings-save-btn" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
